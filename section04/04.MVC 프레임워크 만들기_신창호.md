
# ìŠ¤í”„ë§ì˜ ê°•ì˜ ë¦¬ë·°ğŸ“½
> LoadMap Part : ìŠ¤í”„ë§ MVC íŒ¨í„´ 1í¸   
> Section : 04.MVC í”„ë ˆì„ì›Œí¬ ë§Œë“¤ê¸°  
> CreateDate : 2022.07.16  
> UpdateDate : 2022.07.20

### ëª©ì°¨
 - [í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ íŒ¨í„´ ì†Œê°œ](#Introduction) 
 - [í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ ë„ì…_v1](#Apply)
 - [View ë¶„ë¦¬_v2](#ViewSeparation)
 - [Model ì¶”ê°€_v3](#AddModel)
 - [ë‹¨ìˆœí•˜ê³  ì‹¤ìš©ì ì¸ ì»¨íŠ¸ë¡¤ëŸ¬_v4](#SimpleAndPractical)
 - [ìœ ì—°í•œ ì»¨íŠ¸ë¡¤ëŸ¬1_v5](#AdapterV3)
 - [ìœ ì—°í•œ ì»¨íŠ¸ë¡¤ëŸ¬2](#AdapterV4)

<br></br>

### IntelliJ ë‹¨ì¶•í‚¤
- `ctrl` + `alt` +`M` : ì„ íƒëœ ì½”ë“œ, ì™¸ë¶€ ë©”ì†Œë“œë¡œ ë³€í™˜
- `shift` + `F6` : í´ë˜ìŠ¤ ì´ë¦„, ë©”ì†Œë“œ ì´ë¦„ ë³€ê²½ì‹œ, ì—°ë™ëœ ëª¨ë“  ì´ë¦„ ë³€ê²½
- `ì»´íŒŒì¼ì˜¤ë¥˜ ë¶€ë¶„` + `F2` : ì»´íŒŒì¼ëŸ¬ ì˜¤ë¥˜ê´€ë ¨ëœ ë©”ì‹œì§€ë¥¼ í™•ì¸
- `List<>.iter` : í–¥ìƒëœ forë¬¸ìœ¼ë¡œ ë‚˜íƒ€ë‚œë‹¤.`for(T item : expr)` 
<br></br>
<br></br>

# í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ íŒ¨í„´ ì†Œê°œ<a name="Introduction"></a>

<p align="center"><img src="https://user-images.githubusercontent.com/104331549/179345069-34d95401-e87a-43e2-bb27-8f3383858dc1.png" width="80%"></p>
<p align="center"><img src="https://user-images.githubusercontent.com/104331549/179345073-a68ef97f-298e-4a32-af6c-2461dd1bd7ca.png" width="80%"></p>

## FrontController íŒ¨í„´ íŠ¹ì§•
 - FrontControllerë„ í•˜ë‚˜ì˜ ì„œë¸”ë¦¿ì´ë‹¤.
 - í´ë¼ë¦¬ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ìœ¼ë©´ ìš”ì²­ì— ë§ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì°¾ì•„ì„œ í˜¸ì¶œ
 - ì…êµ¬ë¥¼ í•˜ë‚˜ë¡œ ì²˜ë¦¬í•¨ìœ¼ë¡œ, ê³µí†µ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•´ì§„ë‹¤.
 - ê²°êµ­, í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì„œë¸”ë¦¿ì„ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë¨

### ìŠ¤í”„ë§ ì›¹ MVCì™€ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬
- ìŠ¤í”„ë§ ì›¹ MVCì˜ í•µì‹¬ë„ ë°”ë¡œ **FrontController**
- ìŠ¤í”„ë§ ì›¹ MVCì˜ **DispatcherServlet**ì´ FrontController íŒ¨í„´ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ ìˆìŒ
   - [DispatcherServlet ì•Œì•„ë³´ê¸°](#DispatcherServlet)


<br></br>
<br></br>

# í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ ë„ì…_v1<a name="Apply"></a>
> í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë‹¨ê³„ì ìœ¼ë¡œ ë„ì…í•´ë³´ì 

### 1ë‹¨ê³„ êµ¬ì¡°
 - Fornt ControllerëŠ” URL ë§¤í•‘ ì •ë³´ì—ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì¡°íšŒí•˜ê³ , ì´ì— í•´ë‹¹ë˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì°¾ì•„ í˜¸ì¶œí•´ì£¼ëŠ” ì—­í•  ì´ë‹¤.
<p align="center"><img src="https://user-images.githubusercontent.com/104331549/179347005-fa97b43d-69ab-4213-850e-6c587a23c351.png" width="80%"></p>

 - JSPëŠ” ì‚¬ìš©í–ˆë˜ ê²ƒì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©
 - í”„ë¡ íŠ¸ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” `ControllerMap`ì— ì¶œë ¥ë  URIë¥¼ ë„£ì–´ ë†“ê³ , í•´ë‹¹ë˜ëŠ” URIë¥¼ ë¶ˆëŸ¬ ë°˜í™˜í•´ì¤€ë‹¤.
   - ë§Œì•½ ì—†ë‹¤ë©´, `404(SC_NOT_FOUND)` ìƒíƒœ ì½”ë“œë¥¼ ë°˜í™˜í•œë‹¤

### ì¸í„°í˜ì´ìŠ¤ ìƒì„±
 - ControllerV1.interface
```java
public interface ControllerV1 {

    void proccess(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException;

}
```
> ê¸°ì¡´ì˜ íšŒì›ë“±ë¡, íšŒì›ì €ì¥, íšŒì› ì¡°íšŒ ê¸°ëŠ¥ì€ ìœ„ì— ë§Œë“¤ì–´ì§„ interfaceë¥¼ ìƒì†ë°›ì•„ êµ¬í˜„í•œë‹¤.

<br></br>

### í”„ë¡ íŠ¸ì»¨íŠ¸ë¡¤ëŸ¬_v1
 - í”„ë¡ íŠ¸ì»¨íŠ¸ë¡¤ëŸ¬ 1ë²„ì „
 - FrontControllerServletV1.java
```java
@WebServlet(name = "frontControllerServletV1", urlPatterns = "/front-controller/v1/*")
public class FrontControllerServletV1 extends HttpServlet {

    private Map<String, ControllerV1> controllerMap = new HashMap<>();

    public FrontControllerServletV1() {
        controllerMap.put("/front-controller/v1/members/new-form", new MemberFormControllerV1());
        controllerMap.put("/front-controller/v1/members/save", new MemberSaveControllerV1());
        controllerMap.put("/front-controller/v1/members", new MemberListControllerV1());
    }

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        String requestURI = request.getRequestURI();

        ControllerV1 controller = controllerMap.get(requestURI);
        if(controller ==null){
            response.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        controller.proccess(request, response);
    }

}
```

<br></br>
<br></br>

# View ë¶„ë¦¬_v2<a name="ViewSeparation"></a>
> **ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë·°ë¡œ ì´ë™í•˜ëŠ” ë¶€ë¶„**ì— ì¤‘ë³µì´ ìˆê³ , ê¹”ë”í•˜ì§€ ì•Šë‹¤.

- ì¤‘ë³µë˜ëŠ” ë¶€ë¶„ì„ Front Controllerë¡œ ë¶„ë¦¬í•´í•˜ì—¬ ë¹¼ë‚¸ë‹¤. 

<p align="center"><img src="https://user-images.githubusercontent.com/104331549/179511967-12fdc7cd-0644-4b13-be4b-c6c80cdc13b8.png" width="80%"></p>

<br></br>

### ë·° ë Œë”ë§ 
 - MyView.java
 - ë§ ê·¸ëŒ€ë¡œ, MyViewëŠ” í•„ë“œê°’ìœ¼ë¡œ `ë·° ê²½ë¡œ`ë¥¼ ê°€ì§€ë©°,
 - renderë©”ì†Œë“œ ì‹¤í–‰ì‹œ, **ë·°**(`.jsp`)**ê°€ ë™ì‘**ë˜ê²Œ í•˜ëŠ” í´ë˜ìŠ¤ì´ë‹¤.
```java
public class MyView {

    private String viewPath;

    public MyView(String viewPath) {
        this.viewPath = viewPath;
    }

    public void render(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        RequestDispatcher dispatcher =request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }

}
```

<br></br>

### í”„ë¡ íŠ¸ì»¨íŠ¸ë¡¤ëŸ¬_v2
- FrontControllerServletV2.java
- ìš”ì²­ ê°’ì— í•´ë‹¹í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì°¾ê³ , 
  - ì°¾ì€ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì—°ê²°ëœ, ViewPathë¥¼ ì°¾ê³  MyViewì— ì €ì¥í•˜ì—¬
  - render()ë©”ì†Œë“œë¡œ ë·° í˜¸ì¶œ(forward)
```java
@WebServlet( name = "frontControllerServletV2", urlPatterns = "/front-controller/v2/*")
public class FrontControllerServletV2 extends HttpServlet {

    private Map<String, ControllerV2> controllerMap = new HashMap<>();

    public FrontControllerServletV2() {
        controllerMap.put("/front-controller/v2/members/new-form", new MemberFormControllerV2());
        controllerMap.put("/front-controller/v2/members/save", new MemberSaveControllerV2());
        controllerMap.put("/front-controller/v2/members", new MemberListControllerV2());
    }

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String requestURI = request.getRequestURI();

        ControllerV2 controller = controllerMap.get(requestURI);

        if (controller == null){
            response.setStatus(HttpServletResponse.SC_NOT_FOUND);
            return;
        }

        MyView view = controller.proccess(request, response); //í•´ë‹¹ URIì— ë§ëŠ” ViewPath ì°¾ê¸°
        view.render(request,response); // view ì‹¤í–‰
    }
}
```
 - ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ **ë°˜í™˜ê°’ì„ ê³ ì •**ì‹œí‚´ìœ¼ë¡œì¨, ë‹¤ë¥¸ ì‚¬ëŒì´ ë´ë„ ì´í•´í•  ìˆ˜ ìˆëŠ” ë§¤ìš° ì¢‹ì€ ì„¤ê³„ê°€ ë¨.
<br></br>
<br></br>

# Model ì¶”ê°€_v3<a name="AddModel"></a>
## ë³€ê²½í•˜ê³ ì í•˜ëŠ” ì 
### ì„œë¸”ë¦¿ ì¢…ì†ì„± ì œê±°
 - Myviewë¥¼ ë°˜í™˜í•´ì£¼ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë³´ë©´, í•„ìš”ì—†ëŠ” ì •ë³´ê°€ ë³´ì¸ë‹¤.
```java
public class MemberFormControllerV2 implements ControllerV2 {

        @Override
        public MyView proccess(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
            // requestë‘, responseê°€ êµ³ì´ í•„ìš”í• ê¹Œ?
            return new MyView("/WEB-INF/views/new-form.jsp");
        }
}
```
 - ìœ„ì— ìˆëŠ” ìš”ì²­ íŒŒë¼ë¯¸í„° ì •ë³´ëŠ”  ìë°”ì˜ Mapìœ¼ë¡œ ëŒ€ì‹  ë„˜ê¸°ë„ë¡í•˜ë©´ ì§€ê¸ˆ êµ¬ì¡°ì—ì„œëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì„œë¸”ë¦¿ ê¸°ìˆ ì„ ëª°ë¼ë„ ë™ì‘í•  ìˆ˜ ìˆë”°. 
 - request ê°ì²´ë¥¼ Modelë¡œ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹ ì— ë³„ë„ì˜ Model ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ë°˜í™˜
   - ì¦‰, `setAtrribute()`ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ. 

### ë·° ì´ë¦„ ì¤‘ë³µì œê±° 
 - ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì§€ì •í•˜ëŠ” ë·° ì´ë¦„ì— ì¤‘ë³µ
   - `/WEB-INF/views/new-form.jsp`  -> ë…¼ë¦¬ ì´ë¦„ : new-form
   - `/WEB-INF/views/save-result.jsp` -> ë…¼ë¦¬ ì´ë¦„ : save-result
   - `/WEB-INF/views/members.jsp` -> ë…¼ë¦¬ ì´ë¦„ : members
 - **ì»¨íŠ¸ë¡¤ëŸ¬**ê°€ ë·°ì˜ **ë…¼ë¦¬ ì´ë¦„ë§Œ ë°˜í™˜**
 - ì‹¤ì œ í’€ë„¤ì„ ìœ„ì¹˜ëŠ” í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì²˜ë¦¬!
    - ë·°ì˜ í´ë” ìœ„ì¹˜(í’€ë„¤ì„)ì´ ë³€ê²½ë˜ë”ë¼ë„, í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ë§Œ ê³ ì¹˜ë©´ ëœë‹¤.
## V3 

<p align="center"><img src="https://user-images.githubusercontent.com/104331549/179528581-c4bd329a-a708-482a-8bd5-3561d609d5a4.png" width="80%"></p>

- 3ë²ˆì§¸, ì›ë˜ëŠ” `MyView`ë¥¼ ë°˜í™˜í–ˆì—ˆì§€ë§Œ, ì´ë²ˆì—” `ModelView`ë¥¼ ë°˜í™˜í•œë‹¤.  
- 4ë²ˆì§¸, ë…¼ë¦¬ ê²½ë¡œ(ì´ë¦„)ë§Œ ìˆê¸°ì—, ì‹¤ì œ ê²½ë¡œ(í’€ë„¤ì„)ìœ¼ë¡œ ë³€í™˜ì‹œì¼œ
  - 5ë²ˆì§¸,`MyView`ë¡œ ë°˜í™˜í•œë‹¤. 

<br></br>

### ëª¨ë¸ ë·°
> ì„œë¸”ë¦¿ì˜ ì¢…ì†ì„±ì„ ì œê±°í•˜ê¸° ìœ„í•´ Modelì„ ì§ì ‘ ë§Œë“¤ê³ , View ì´ë¦„ì„ ì „ë‹¬í•˜ëŠ” ê°ì²´ë¥¼ ë§Œë“¤ì.
 - ì¦‰, ë‹¤ì‹œí•œë²ˆ ì–¸ê¸‰í•˜ì§€ë§Œ `setAtrribute()`ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
 - ModelView.java
```java
@Getter
@Setter
public class ModelView {
    private String viewName;
    private Map<String, Object> model = new HashMap<>();

    public ModelView(String viewName) {
        this.viewName = viewName;
    }
}
```
 - ì´ë•ì— `Controller`ë“¤ì€ `Map<>`ì„ ì¸ìë¡œ ë°›ìœ¼ë©°,
   - ë°˜í™˜ìœ¼ë¡œ `viewName`ì„ ì´ˆê¸°í™”í•˜ê³  `ModelView` ìƒì„±í•´ì¤€ë‹¤.

<br></br>

### 1ë‹¨ê³„ í”„ë¡ íŠ¸ì»¨íŠ¸ë¡¤ëŸ¬_v3 
 - ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ viewModelì„ ì „ì†¡í•´ì£¼ëŠ” ë‹¨ê³„ê¹Œì§€ë§Œ êµ¬í˜„
 - 1ì°¨ FrontControllerServletV3.java
```java
// ë™ì¼í•œ ë¶€ë¶„ ìƒëµ
public class FrontControllerServletV3 extends HttpServlet {

    private Map<String, ControllerV3> controllerMap = new HashMap<>();
    
    // ë™ì¼í•œ ë¶€ë¶„ ìƒëµ
    
    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        // ë™ì¼í•œ ë¶€ë¶„ ìƒëµ

        //paramMap
        Map<String, String> paramMap = createParamMap(request);

        ModelView modelView = controller.process(paramMap);
        // ì—ëŸ¬ê°€ ë‚œë‹¤.
        view.render(request, response);
    }

    private Map<String, String> createParamMap(HttpServletRequest request) { // Requestì—ì„œ í•„ìš”í•œ íŒŒë¼ë¯¸í„° ì¶”ì¶œí•˜ê¸°
        Map<String, String> paramMap = new HashMap<>();
        request.getParameterNames().asIterator()
                .forEachRemaining(paramName -> paramMap.put(paramName, request.getParameter(paramName)));
        return paramMap;
    }
}
```
 - viewModelì€ ë·°ì˜ **ê²½ë¡œ**ê°€ ë…¼ë¦¬ì´ë¦„ë§Œ ì¡´ì¬í•˜ê¸°ì—, ì¶”ê°€í•´ì¤˜ì•¼í•œë‹¤. 
 - ë˜í•œ, íŒŒë¼ë¯¸í„° ê°’ì„ ë³´ê´€í•˜ëŠ” `model`ê°’ë„ view ë¡œ ì „ë‹¬í•´ì¤˜ì•¼í•œë‹¤. 

<br></br>
### 2ë‹¨ê³„ í”„ë¡ íŠ¸ì»¨íŠ¸ë¡¤ëŸ¬_v3
 - í’€ ê²½ë¡œë¡œ ë§Œë“œëŠ” ë°©ë²•ì€ ê°„ë‹¨í•˜ë‹¤. ì•ë’¤ì— ì¶”ê°€í•´ì£¼ë©´ ëœë‹¤. 
```java
new MyView("/WEB-INF/views/" + modelView.getViewName() + ".jsp");
```
 - ì´ë¡œì¨, modelViewê°’ì´ ì™„ì„±ë˜ì—ˆê³ , ì´ì œ MyViewì— ë„£ì–´ ë„˜ê²¨ì¤˜ì•¼í•œë‹¤.
 - í•˜ì§€ë§Œ, modelì„ ì¸ìë¡œ ë°›ëŠ” render() ë©”ì†Œë“œê°€ ì¡´ì¬í•˜ì§€ì•Šìœ¼ë¯€ë¡œ, ë§Œë“¤ì–´ ì¤˜ì•¼í•œë‹¤.
```java
ModelView modelView = controller.process(paramMap);
String viewName = modelView.getViewName();
MyView view = viewResolver(viewName); 

view.render(modelView.getModel(),request, response); //ì¡´ì¬í•˜ì§€ ì•ŠìŒ
```

### MyView
 - render()ë©”ì†Œë“œë¥¼ ì˜¤ë²„ë¡œë”©ìœ¼ë¡œ ì¸ìê°€ ë‹¤ë¥¸ render(ëª¨ë¸, request, response)ë§Œë“¤ì–´ ì¤€ë‹¤.
 - `JSP`ëŠ” request.getAttribute() ë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê¸° ë•Œë¬¸ì—, 
   - ëª¨ë¸ì˜ ë°ì´í„°ë¥¼ êº¼ë‚´ì„œ request.setAttribute() ë¡œ ë‹´ì•„ë‘”ë‹¤
 ```java
public class MyView {
    //ìƒëµ
    public void render(Map<String, Object> model, HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        modelToRequestAttribute(model, request);
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request, response);
    }

    private void modelToRequestAttribute(Map<String, Object> model, HttpServletRequest request) {
        model.forEach((key, value) -> request.setAttribute(key, value)); // JSPë•Œë¬¸ì— ë°ì´í„°ë¥¼ request.setAttribute()ë¡œ ë‹´ì•„ì¤€ë‹¤.
    }
}
 ```
- ìœ„ ì½”ë“œë“¤ì€ ë” ë³µì¡í•˜ê³  ì§€ì €ë¶„í•´ ë³´ì´ì§€ë§Œ, ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë§¤ìš° ê°„ë‹¨í•´ì¡Œë‹¤.

<br></br>
  <br></br>

# ë‹¨ìˆœí•˜ê³  ì‹¤ìš©ì ì¸ ì»¨íŠ¸ë¡¤ëŸ¬_v4<a name="SimpleAndPractical"></a>
 > êµ¬ì¡°ì ìœ¼ë¡œë„ ì˜ êµ¬í˜„í–ˆì§€ë§Œ, ì‹¤ì œ ì»¨íŠ¸í†¨ëŸ¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” ê°œë°œì ì…ì¥ì—ì„œ ë³´ë©´,   
 > í•­ìƒ ModelView ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë°˜í™˜í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ì´ ì¡°ê¸ˆì€ ë²ˆê±°ë¡­ë‹¤. ex) EJB

 - ì¦‰, ê°œë°œì(ì‚¬ìš©ì)í•œí…Œ ë¶ˆë³€í•˜ë©´, ë” í¸ë¦¬í•˜ê²Œ ë³€ê²½í•˜ë ¤ê³  í•œë‹¤. 

## V4
 - ê¸°ë³¸ì ì¸ êµ¬ì¡°(ì•„í‚¤í…ì²˜)ëŠ” V3ì™€ ê°™ë‹¤.
 - ëŒ€ì‹  ì»¨íŠ¸ë¡¤ëŸ¬ê°€ `(class)ModelView`ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ `(String)viewName`ë§Œ ë°˜í™˜í•œë‹¤.
    
<p align="center"><img src="https://user-images.githubusercontent.com/104331549/179543762-1eb7d32a-fce3-48ac-9e71-4e4dc0b58926.png" width="80%"></p>

 - ì»¨íŠ¸ë¡¤ë¡œê°€ ì§ì ‘ ë·°ì˜ ë…¼ë¦¬ ì´ë¦„ì„ ë°˜í™˜í•˜ë¯€ë¡œ ì´ ê°’ì„ ì‚¬ìš©í•´ì„œ ì‹¤ì œ ë¬¼ë¦¬ ë·°ë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤.
```java
//paramMap
Map<String, String> paramMap = createParamMap(request);
// Model
Map<String, Object> model = new HashMap<>();

String viewName = controller.process(paramMap, model);
MyView view = viewResolver(viewName);
```

> ì´ë ‡ê²Œ ì—¬ê¸°ê¹Œì§€ í•œë²ˆì— ì˜¨ ê²ƒì´ ì•„ë‹ˆë¼, í”„ë ˆì„ì›Œí¬ê°€ ì ì§„ì ìœ¼ë¡œ ë°œì „í•˜ëŠ” ê³¼ì • ì†ì—ì„œ ë³€í™”í•œ ê²ƒì„ì„ ì•Œì•„ì•¼í•œë‹¤.  
> í•˜ì§€ë§Œ, ì´ëŸ¬í•œ ì»¨íŠ¸ë¡¤ëŸ¬ì—ë„ ì•„ì§ ë‹¨ì ì´ ë‚¨ì•„ìˆë‹¤.  
> ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ëª¨ì–‘ì´ í•­ìƒ ì •í•´ì ¸ì„œ ì¸í„°í˜ì´ìŠ¤ê°€ ì œì•½ë˜ì–´ ìˆë‹¤.  
> ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸°ìœ„í•´ì„œëŠ”, ì–´ëŒ‘í„°ë¥¼ ì•Œì•„ì•¼í•œë‹¤.

<br></br>
<br></br>

# ìœ ì—°í•œ ì»¨íŠ¸ë¡¤ëŸ¬1 - v5<a name="AdapterV3"></a>
> ë§Œì•½ ì–´ë–¤ ê°œë°œìëŠ” ControllerV3 ë°©ì‹ìœ¼ë¡œ ê°œë°œí•˜ê³  ì‹¶ê³ , ì–´ë–¤ ê°œë°œìëŠ” ControllerV4 ë°©ì‹ìœ¼ë¡œ ê°œë°œí•˜ê³  ì‹¶ë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?

```java
private Map<String, ControllerV4> controllerMap = new HashMap<>(); // V4 ì¸í„°í˜ì´ìŠ¤ë¡œ ê³ ì •

public FrontControllerServletV4() {
    controllerMap.put("/front-controller/v4/members/new-form", new MemberFormControllerV4());
    controllerMap.put("/front-controller/v4/members/save", new MemberSaveControllerV4());
    controllerMap.put("/front-controller/v4/members", new MemberListControllerV4()); // V3ë²„ì „ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ê°€ ì—†ë‹¤.
}
```

<br></br>

## ì–´ëŒ‘í„° íŒ¨í„´ 
> ì´ëŸ´ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ `ì–´ëŒ‘í„°`ì´ë‹¤.  
> í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë‹¤ì–‘í•œ ë°©ì‹ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

- V5 êµ¬ì¡°
<p align="center"><img src="https://user-images.githubusercontent.com/104331549/179903575-10f8c1c5-dfb9-476f-b7da-490bb0b7b070.png" width="80%"></p>


### í•¸ë“¤ëŸ¬(Handler)
 - ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì´ë¦„ì„ ë” ë„“ì€ ë²”ìœ„ì¸ í•¸ë“¤ëŸ¬ë¡œ ë³€ê²½í–ˆë‹¤. 
   - ê·¸ ì´ìœ ëŠ” ì´ì œ ì–´ëŒ‘í„°ê°€ ìˆê¸° ë•Œë¬¸ì— ê¼­ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ê°œë… ë¿ë§Œ ì•„ë‹ˆë¼ ì–´ë– í•œ ê²ƒì´ë“  í•´ë‹¹í•˜ëŠ” ì¢…ë¥˜ì˜ ì–´ëŒ‘í„°ë§Œ ìˆìœ¼ë©´ ë‹¤ ì²˜ë¦¬í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤

<p align="center"><img src="https://user-images.githubusercontent.com/104331549/179906040-91457be6-97b0-49f2-afee-4e398daa10b2.png" width="80%"></p>

<br></br>

### í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°(Handler Adapter)
- ì¤‘ê°„ì— ì–´ëŒ‘í„° ì—­í• ì„ í•˜ëŠ” ì–´ëŒ‘í„°ê°€ ì¶”ê°€ë˜ì—ˆë‹¤.
- ì´ë¦„ì€ `Handler Adapter`ì´ë‹¤.
- ì–´ëŒ‘í„°ëŠ” ë‹¤ì–‘í•œ ì¢…ë¥˜ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í˜¸ì¶œ í•  ìˆ˜ ìˆë‹¤. (í™•ì¥ì„±ì´ ì¢‹ì•„ì§)
- **ì¸í„°í˜ì´ìŠ¤**ì´ë‹¤.

<br></br>

### MyHandlerAdapter
> 2ê°€ì§€ì˜ ê¸°ëŠ¥ì´ ìˆë‹¤.
 - `boolean supports(Object handler)`
   - ì–´ëŒ‘í„°ê°€ í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ì§€ë¥¼ ì°¾ì•„ë³¸ë‹¤.(ì²˜ë¦¬ ê°€ëŠ¥ - `true` , ì²˜ë¦¬ ë¶ˆê°€ëŠ¥ - `false` ) 
 - `ModelView handle(HttpServletRequest request, HttpServletResponse response, Object handler)`
   - ì–´ëŒ‘í„°ëŠ” ì‹¤ì œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í˜¸ì¶œí•˜ê³ , ê·¸ ê²°ê³¼ë¡œ ModelViewë¥¼ **ë°˜í™˜**í•´ì•¼ í•œë‹¤.
   - ì‹¤ì œ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ModelViewë¥¼ ë°˜í™˜í•˜ì§€ ëª»í•˜ë©´, ì–´ëŒ‘í„°ê°€ ModelViewë¥¼ ì§ì ‘ ìƒì„±í•´ì„œë¼ë„ ë°˜í™˜í•´ì•¼ í•œë‹¤.
   - ì›ë˜ í”„ë¡ íŠ¸ì»¨íŠ¸ë¡¤ëŸ¬ê°€ í–ˆë˜ ì¼ì´ì§€ë§Œ, ì´ì œëŠ” ì´ ì–´ëŒ‘í„°ë¥¼ ê±°ì³ í˜¸ì¶œí•œë‹¤.
- ì‰½ê²Œ ë§í•´, í•˜ë‚˜ëŠ” ì°¾ëŠ” ê¸°ëŠ¥ì´ê³ , ë‹¤ë¥¸ í•˜ë‚˜ëŠ” ë°˜í™˜í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤.

<br></br>

### í”„ë¡ íŠ¸ì»¨íŠ¸ë¡¤ëŸ¬v5
- ê¸°ì¡´ ë²„ì „ì˜ **ì»¨íŠ¸ë¡¤ëŸ¬ ê´€ë¦¬**
```java
private Map<String, ControllerV4> controllerMap = new HashMap<>();
```

- `adapter`ë¥¼ ì´ìš©í•œ ìƒˆë¡œìš´ ë²„ì „ì˜ **í•¸ë“¤ëŸ¬ ê´€ë¦¬**
- `adapter`ë¥¼ ë³´ê´€í•  `List`ìƒì„±
```java
private final Map<String, Object> handlerMappeingMap = new HashMap<>();
private final List<MyHandlerAdapter> handlerAdapters = new ArrayList<>();
```

- adpterì°¾ê¸° ê¸°ëŠ¥
- adapterì— ì—°ê²°ëœ í•¸ë“¤ëŸ¬(controller)ì‚¬ìš©í•˜ì—¬, ModelView ë°˜í™˜
```java
@Override
protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    Object handler = getHandler(request);
    if (handler == null) {
        response.setStatus(HttpServletResponse.SC_NOT_FOUND);
        return;
    }

    // adapter ì°¾ê¸°
    MyHandlerAdapter adapter = getHandlerAdapter(handler);

    // adapterì•ˆì— ìˆëŠ” í•¸ë“¤ëŸ¬ì‚¬ìš©
    ModelView mv = adapter.handle(request, response, handler);

    String viewName = mv.getViewName();
    MyView view = viewResolver(viewName);

    view.render(mv.getModel(), request, response);
}
private MyView viewResolver(String viewName) {
    MyView view = new MyView("/WEB-INF/views/" + viewName + ".jsp");
    return view;
}


// adapter ì°¾ëŠ” ë©”ì†Œë“œ
private MyHandlerAdapter getHandlerAdapter(Object handler) {
    for (MyHandlerAdapter adapter : handlerAdapters) {
        if (adapter.supports(handler)) {
            return adapter;
        }
    }
    throw new IllegalArgumentException("handler adapterë¥¼ ì°¾ì„ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤. handler =" + handler);
}

private Object getHandler(HttpServletRequest request) {
    String requestURI = request.getRequestURI();
    return handlerMappeingMap.get(requestURI);
}
```

<br></br>
<br></br>

# ìœ ì—°í•œ ì»¨íŠ¸ë¡¤ëŸ¬2<a name="AdapterV4"></a>
> ì´ë²ˆì—” ì»¨íŠ¸ë¡¤ëŸ¬V4ë¥¼ ë„£ì–´ë³´ì.


## í•¸ë“¤ëŸ¬ ë§¤í•‘ ë§µê³¼ í•¸ë“¤ëŸ¬ ì–´ëŒ‘í„°
 - `initHandlerMappeingMap()` :í•¸ë“¤ëŸ¬ ë§¤í•‘í•  ì •ë³´ ì¶”ê°€
 - `initHandlerAdapters()` : ì–´ëŒ‘í„° ì •ë³´ ì¶”ê°€
```java
private void initHandlerMappeingMap() {
    handlerMappeingMap.put("/front-controller/v5/v3/members/new-form", new MemberFormControllerV3());
    handlerMappeingMap.put("/front-controller/v5/v3/members/save", new MemberSaveControllerV3());
    handlerMappeingMap.put("/front-controller/v5/v3/members", new MemberListControllerV3());
    
    handlerMappeingMap.put("/front-controller/v5/v4/members/new-form", new MemberFormControllerV4());
    handlerMappeingMap.put("/front-controller/v5/v4/members/save", new MemberSaveControllerV4());
    handlerMappeingMap.put("/front-controller/v5/v4/members", new MemberListControllerV4());
}

private void initHandlerAdapters() {
    handlerAdapters.add(new ControllerV3HandlerAdapter());
    
    handlerAdapters.add(new ControllerV4HandlerAdapter());
}
```
 - í”„ë¡ íŠ¸ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì¶”ê°€ë˜ëŠ” ì½”ë“œëŠ” ìœ„ì˜ ì •ë³´ë§Œ ì¶”ê°€í•˜ë©´ ëœë‹¤.(í™•ì¥ì„±ì´ ì¢‹ìŒ) 


### ControllerV4HandlerAdapter
 - `ControllerV4HandlerAdapter`ëŠ” `ControllerV3HandlerAdapter`ì™€ ìœ ì‚¬í•œ êµ¬ì¡°ì´ë‹¤. 
 - ì°¨ì´ì ì´ë¼ë©´, ì»¨íŠ¸ë¡¤ëŸ¬V4ì˜ ê²½ìš° `Modelview`ë¥¼ ë§Œë“¤ì§€ ì•Šê³  Map<>íƒ€ì…ì˜ modelë³€ìˆ˜ë¡œ ë„˜ê¸°ì§€ë§Œ, 
 - í”„ë¡ íŠ¸ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œëŠ” `Modelview`ê°€ í•„ìš”í•¨ìœ¼ë¡œ ì–´ëŒ‘í„°ê°€ ë‚´ë¶€ì ìœ¼ë¡œ `Modelview` ë¥¼ ìƒì„±í•´ì¤€ë‹¤.(ì´ê²ƒì´ ì–´ëŒ‘í„°ì˜ ì—­í• )
   - ë§ˆì¹˜ 110v ì „ê¸° ì½˜ì„¼íŠ¸ë¥¼ 220v ì „ê¸° ì½˜ì„¼íŠ¸ë¡œ ë³€ê²½í•˜ë“¯ì´!
```java
// ì–´ëŒ‘í„° í•µì‹¬ ë¶€ë¶„
ModelView mv = new ModelView(viewName);
mv.setModel(model);
```

<br></br>

## ì •ë¦¬
- v1: í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë„ì…
  - ê¸°ì¡´ êµ¬ì¡°ë¥¼ ìµœëŒ€í•œ ìœ ì§€í•˜ë©´ì„œ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë„ì…
- v2: View ë¶„ë¥˜
  - ë‹¨ìˆœ ë°˜ë³µ ë˜ëŠ” ë·° ë¡œì§ ë¶„ë¦¬
- v3: Model ì¶”ê°€
  - ì„œë¸”ë¦¿ ì¢…ì†ì„± ì œê±°
  - ë·° ì´ë¦„ ì¤‘ë³µ ì œê±°
- v4: ë‹¨ìˆœí•˜ê³  ì‹¤ìš©ì ì¸ ì»¨íŠ¸ë¡¤ëŸ¬
  - v3ì™€ ê±°ì˜ ë¹„ìŠ·
  - êµ¬í˜„ ì…ì¥ì—ì„œ ModelViewë¥¼ ì§ì ‘ ìƒì„±í•´ì„œ ë°˜í™˜í•˜ì§€ ì•Šë„ë¡ í¸ë¦¬í•œ ì¸í„°í˜ì´ìŠ¤ ì œê³µ
- v5: ìœ ì—°í•œ ì»¨íŠ¸ë¡¤ëŸ¬
  - ì–´ëŒ‘í„° ë„ì…
  - ì–´ëŒ‘í„°ë¥¼ ì¶”ê°€í•´ì„œ í”„ë ˆì„ì›Œí¬ë¥¼ ìœ ì—°í•˜ê³  í™•ì¥ì„± ìˆê²Œ ì„¤ê³„



<br></br>
<br></br>



## ëŠë‚€ì  ğŸ˜Œ
 - ê³µí†µë˜ê³ , ì§€ì €ë¶„í•´ì§€ëŠ” ì½”ë“œëŠ” í”„ë¡ íŠ¸ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì²˜ë¦¬í•´ì£¼ê³ 
 - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ë‘, ë·° ì½”ë“œëŠ” ë§¤ìš° ê¹”ë”í•˜ê²Œ í•´ì£¼ëŠ”ë“¯ í•˜ë‹¤.


## ì°¸ê³  ë§í¬
### DispatcherServlet<a name="DispatcherServlet"></a>
 - spring MVC web í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì—ˆë‹¤ë©´, ì´ë¯¸ ì™¸ë¶€ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ê°€ì§€ê³  ìˆê²Œ ëœë‹¤.

<img src="https://user-images.githubusercontent.com/104331549/179345999-fbbf7003-e1f3-4317-ae77-d605c383de51.png" width="70%">

 - ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ì€ í”„ë¡ íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œì¨, í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì–´ë– í•œ ìš”ì²­ì´ ì˜¤ê²Œ ë˜ë©´ ëª¨ë“  ìš”ì²­ì„ ë¨¼ì € ë°›ê²Œ ëœë‹¤. 
    - ê·¸ë¦¬ê³  ìš”ì²­ë“¤ì„ ì„¸ë¶€ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ìœ„ì„í•œë‹¤. 

#### ë””ìŠ¤íŒ¨ì²˜ì„œë¸”ë¦¿ êµ¬í˜„ ë°©ë²• 
 1. ë¨¼ì € DispatcherServletì„ ìƒì„±í•œë‹¤.
 2. ì›ë˜ì˜ ì—­í• ì¸ ê³µí†µìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ì‘ì—…ì„ ì¶”ê°€í•´ì¤€ë‹¤.
 3. ê·¸ë¦¬ê³  ë””ìŠ¤íŒ¨ì²˜ì„œë¸”ë¦¿ì´ ê´€ë¦¬í•˜ëŠ” controllerë¥¼ ì¼ì¼ì´ ë§¤í•‘í•´ì¤€ë‹¤. 
 4. ê·¸ë¦¬ê³  ìš”ì²­ì„ ë°›ìœ¼ë©´, ì»¨íŠ¸ë¡¤ëŸ¬ì—ê²Œ ìœ„ì„í•´ì£¼ê³ , ì‘ì—…ì´ ëë‚˜ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ì—ê²Œ ì‘ë‹µì„ ë°›ì•„ ë·° ì˜¤ë¸Œì íŠ¸ì— ëª¨ë¸ì„ ë„˜ê²¨ì£¼ë©° ìµœì¢… ê²°ê³¼ë¬¼ì„ ìƒì„±í•œë‹¤.

<p align="center"><img src="https://user-images.githubusercontent.com/104331549/179346775-6f9b9811-3378-416b-91ec-b7e785cb4ce6.png" width="80%"></p>



- [Dispatcher-Servlet](https://mangkyu.tistory.com/18)